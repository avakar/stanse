<?xml version="1.0" encoding="UTF-8" ?>
<automaton>
  <description name="Locking checker"
               desc="Checks locks with one argument as the name of the lock." />
  
  <pattern name="locking">
    <functionCall>
      <expression>
        <id>lock</id>
      </expression>
      <expression>
        <var name="A" />
      </expression>
    </functionCall>
  </pattern>
  
  <pattern name="unlocking">
    <functionCall>
      <expression>
        <id>unlock</id>
      </expression>
      <expression>
        <var name="A" />
      </expression>
    </functionCall>
  </pattern>
  
  <start state="Unlocked" />
  <transition from="Unlocked[A]" by="locking[A]" to="Locked[A]" />
  <transition from="Locked[A]" by="unlocking[A]" to="Unlocked[A]" />
  
  <error from="Unlocked[A]" by="unlocking[A]"
         desc="Double unlock"
         level="0"
         entry="Function called in unlocked state."
         begin="The lock is unlocked here."
         propag="not affected --> the lock is still unlocked."
         end="The lock is unlocked and here is attempt to unlock it twice." />
  <error from="Locked[A]" by="locking[A]"
         desc="Double lock"
         level="0"
         entry="Function called in locked state."
         begin="The lock is locked here."
         propag="not affected --> the lock is still locked."
         end="The lock is locked and here is attempt to lock it twice." />
</automaton>
